<!DOCTYPE html>
<html lang="en-IN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout | jay</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        body { background-color: #f1f2f4; font-family: Arial, sans-serif; }
        .main-container { max-width: 800px; margin: 0 auto; background-color: #fff; min-height: 100vh; padding: 20px; }
        .page-header { background-color: #fff; padding: 10px 0; margin-bottom: 20px; border-bottom: 1px solid #e0e0e0; }
        .back-arrow { color: #212121; text-decoration: none; font-size: 24px; margin-right: 16px; }
        
        .step-box { background: #fff; border: 2px solid #e0e0e0; border-radius: 8px; padding: 20px; margin-bottom: 16px; }
        .step-box.completed { border-color: #4caf50; background: #f1f8f4; }
        .step-box.active { border-color: #2874f0; }
        
        .step-header { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; }
        .step-number { width: 32px; height: 32px; background: #e0e0e0; color: #666; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .step-box.active .step-number { background: #2874f0; color: #fff; }
        .step-box.completed .step-number { background: #4caf50; color: #fff; }
        .step-box.completed .step-number::after { content: '✓'; }
        
        .step-title { font-size: 18px; font-weight: 600; flex: 1; }
        .change-btn { color: #2874f0; cursor: pointer; text-decoration: underline; font-size: 14px; }
        
        .step-content { display: none; }
        .step-box.active .step-content { display: block; }
        
        .form-group { margin-bottom: 16px; }
        .form-label { font-weight: 500; margin-bottom: 6px; display: block; }
        .form-control { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .form-control:focus { border-color: #2874f0; outline: none; }
        
        .continue-btn { background: #fb641b; color: #fff; border: none; padding: 12px 32px; font-size: 16px; font-weight: 500; border-radius: 4px; cursor: pointer; }
        .continue-btn:hover { background: #e55a15; }
        
        .summary-text { color: #666; font-size: 14px; margin-top: 8px; }
    </style>
</head>
<body>
<div class="main-container">
    <header class="page-header">
        <a href="cart.html" class="back-arrow"><i class="material-icons">arrow_back</i></a>
        <span style="font-size: 20px; font-weight: 600;">Checkout</span>
    </header>

    <!-- Step 1: Address -->
    <div class="step-box active" id="step1">
        <div class="step-header">
            <span class="step-number">1</span>
            <span class="step-title">DELIVERY ADDRESS</span>
            <span class="change-btn" id="changeBtn1" style="display: none;" onclick="editStep1()">CHANGE</span>
        </div>
        <div class="summary-text" id="summary1" style="display: none;"></div>
        <div class="step-content">
            <div class="form-group">
                <label class="form-label">Full Name *</label>
                <input type="text" class="form-control" id="fullName" required>
            </div>
            <div class="form-group">
                <label class="form-label">Mobile Number *</label>
                <input type="tel" class="form-control" id="mobile" pattern="[0-9]{10}" required>
            </div>
            <div class="form-group">
                <label class="form-label">Address *</label>
                <input type="text" class="form-control" id="address" required>
            </div>
            <div class="form-group">
                <label class="form-label">City *</label>
                <input type="text" class="form-control" id="city" required>
            </div>
            <div class="form-group">
                <label class="form-label">Pincode *</label>
                <input type="text" class="form-control" id="pincode" pattern="[0-9]{6}" required>
            </div>
            <button class="continue-btn" onclick="goToStep2()">CONTINUE</button>
        </div>
    </div>

    <!-- Step 2: Review -->
    <div class="step-box" id="step2">
        <div class="step-header">
            <span class="step-number">2</span>
            <span class="step-title">ORDER SUMMARY</span>
            <span class="change-btn" id="changeBtn2" style="display: none;" onclick="editStep2()">CHANGE</span>
        </div>
        <div class="summary-text" id="summary2" style="display: none;"></div>
        <div class="step-content">
            <div id="orderItems"></div>
            <div style="margin-top: 20px; padding: 16px; background: #f8f9fa; border-radius: 6px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                    <span>Total:</span>
                    <span id="totalPrice" style="font-weight: bold; font-size: 18px;">₹0</span>
                </div>
            </div>
            <button class="continue-btn" style="margin-top: 16px;" onclick="goToStep3()">CONTINUE</button>
        </div>
    </div>

    <!-- Step 3: Payment -->
    <div class="step-box" id="step3">
        <div class="step-header">
            <span class="step-number">3</span>
            <span class="step-title">PAYMENT OPTIONS</span>
        </div>
        <div class="step-content">
            <div style="margin-bottom: 12px; padding: 12px; border: 1px solid #e0e0e0; border-radius: 6px;">
                <label>
                    <input type="radio" name="payment" value="cod" checked> Cash on Delivery (COD)
                </label>
            </div>
            <div style="margin-bottom: 12px; padding: 12px; border: 1px solid #e0e0e0; border-radius: 6px;">
                <label>
                    <input type="radio" name="payment" value="upi"> UPI / PhonePe / Google Pay
                </label>
            </div>
            <button class="continue-btn" onclick="placeOrder()">
                <i class="bi bi-lock-fill"></i> PLACE ORDER
            </button>
        </div>
    </div>
</div>

<script src="js/cart.js"></script>
<script>
function goToStep2() {
    // Validate
    const name = document.getElementById('fullName').value;
    const mobile = document.getElementById('mobile').value;
    const address = document.getElementById('address').value;
    const city = document.getElementById('city').value;
    const pincode = document.getElementById('pincode').value;
    
    if (!name || !mobile || !address || !city || !pincode) {
        alert('Please fill all required fields!');
        return;
    }
    
    // Mark step 1 complete
    document.getElementById('step1').classList.remove('active');
    document.getElementById('step1').classList.add('completed');
    document.getElementById('summary1').textContent = `${name}, ${city} - ${pincode}`;
    document.getElementById('summary1').style.display = 'block';
    document.getElementById('changeBtn1').style.display = 'block';
    
    // Activate step 2
    document.getElementById('step2').classList.add('active');
    
    // Load cart items
    loadCartItems();
    
    window.scrollTo(0, 0);
}

function goToStep3() {
    // Mark step 2 complete
    document.getElementById('step2').classList.remove('active');
    document.getElementById('step2').classList.add('completed');
    const total = cartManager.getCartTotal();
    const count = cartManager.getCartCount();
    document.getElementById('summary2').textContent = `${count} item(s), Total: ₹${total}`;
    document.getElementById('summary2').style.display = 'block';
    document.getElementById('changeBtn2').style.display = 'block';
    
    // Activate step 3
    document.getElementById('step3').classList.add('active');
    
    window.scrollTo(0, 0);
}

function editStep1() {
    document.getElementById('step1').classList.add('active');
    document.getElementById('step1').classList.remove('completed');
    document.getElementById('step2').classList.remove('active', 'completed');
    document.getElementById('step3').classList.remove('active', 'completed');
    document.getElementById('summary1').style.display = 'none';
    document.getElementById('changeBtn1').style.display = 'none';
    window.scrollTo(0, 0);
}

function editStep2() {
    document.getElementById('step2').classList.add('active');
    document.getElementById('step2').classList.remove('completed');
    document.getElementById('step3').classList.remove('active', 'completed');
    document.getElementById('summary2').style.display = 'none';
    document.getElementById('changeBtn2').style.display = 'none';
    window.scrollTo(0, 0);
}

function loadCartItems() {
    const cart = cartManager.getCart();
    if (cart.length === 0) {
        window.location.href = 'cart.html';
        return;
    }
    
    const html = cart.map(item => `
        <div style="display: flex; gap: 12px; padding: 12px 0; border-bottom: 1px solid #f0f0f0;">
            <img src="${item.image}" style="width: 60px; height: 60px; object-fit: contain;">
            <div>
                <div style="font-size: 14px;">${item.name}</div>
                <div style="font-weight: 600; margin-top: 4px;">₹${item.price} × ${item.quantity}</div>
            </div>
        </div>
    `).join('');
    
    document.getElementById('orderItems').innerHTML = html;
    document.getElementById('totalPrice').textContent = '₹' + cartManager.getCartTotal();
}

function placeOrder() {
    const paymentMethod = document.querySelector('input[name="payment"]:checked').value;
    
    const orderData = {
        address: {
            fullName: document.getElementById('fullName').value,
            mobile: document.getElementById('mobile').value,
            address: document.getElementById('address').value,
            city: document.getElementById('city').value,
            pincode: document.getElementById('pincode').value
        },
        items: cartManager.getCart(),
        total: cartManager.getCartTotal(),
        paymentMethod: paymentMethod,
        orderDate: new Date().toISOString()
    };

    const orders = JSON.parse(localStorage.getItem('orders') || '[]');
    const orderId = 'ORD' + Date.now();
    orders.push({ orderId, ...orderData });
    localStorage.setItem('orders', JSON.stringify(orders));

    cartManager.clearCart();
    window.location.href = `order-success.html?orderId=${orderId}`;
}

// Check cart on load
document.addEventListener('DOMContentLoaded', function() {
    const cart = cartManager.getCart();
    if (cart.length === 0) {
        window.location.href = 'cart.html';
    }
});
</script>
</body>
</html>
